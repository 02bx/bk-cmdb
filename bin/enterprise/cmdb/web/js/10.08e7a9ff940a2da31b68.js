webpackJsonp([10],{E7tV:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("bOdI"),s=i.n(n),o=i("woOf"),a=i.n(o),r=i("Xxa5"),l=i.n(r),c=i("//Fk"),u=i.n(c),d=i("exGp"),p=i.n(d),h=i("Dd8w"),b=i.n(h),m=i("NYxO"),f=i("BZR1"),v=i("k43u"),g={components:{cmdbColumnsConfig:f.a,cmdbAuditHistory:v.a},data:function(){return{properties:[],propertyGroups:[],table:{checked:[],header:[],list:[],pagination:{count:0,size:10,current:1},defaultSort:"bk_inst_id",sort:"bk_inst_id"},filter:{id:"",value:"",type:"",options:[]},slider:{show:!1,title:""},tab:{active:"attribute"},attribute:{type:null,inst:{details:{},edit:{}}},columnsConfig:{show:!1,selected:[]}}},computed:b()({},Object(m.c)(["supplierAccount"]),Object(m.c)("userCustom",["usercustom"]),{objId:function(){return this.$route.params.objId},customColumns:function(){return this.usercustom[this.objId+"_table_columns"]},url:function(){var t=window.Site.url+"insts/owner/"+this.supplierAccount+"/object/"+this.objId+"/";return{import:t+"import",export:t+"export"}}}),watch:{"filter.id":function(t){this.filter.value="",this.filter.type=(this.$tools.getProperty(this.properties,t)||{}).bk_property_type},customColumns:function(){this.setTableHeader()},objId:function(){this.reload()}},created:function(){this.reload()},methods:b()({},Object(m.b)("objectModelFieldGroup",["searchGroup"]),Object(m.b)("objectModelProperty",["searchObjectAttribute"]),Object(m.b)("objectCommonInst",["createInst","searchInst","updateInst","batchUpdateInst","deleteInst","batchDeleteInst"]),{reload:function(){var t=this;return p()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.searchObjectAttribute({params:{bk_obj_id:t.objId,bk_supplier_account:t.supplierAccount},config:{requestId:t.objId+"Attribute",fromCache:!0}});case 3:return t.properties=e.sent,e.next=6,u.a.all([t.getPropertyGroups(),t.setTableHeader(),t.setFilterOptions()]);case 6:t.getTableData(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}},e,t,[[0,9]])}))()},getPropertyGroups:function(){var t=this;return this.searchGroup({objId:this.objId,config:{fromCache:!0,requestId:this.objId+"AttributeGroup"}}).then(function(e){return t.propertyGroups=e,e})},setTableHeader:function(){var t=this;return new u.a(function(e,i){e(t.$tools.getHeaderProperties(t.properties,t.customColumns))}).then(function(e){t.updateTableHeader(e),t.columnsConfig.selected=e.map(function(t){return t.bk_property_id})})},setFilterOptions:function(){this.filter.options=this.properties.map(function(t){return{id:t.bk_property_id,name:t.bk_property_name}}),this.filter.id=this.filter.options.length?this.filter.options[0].id:""},updateTableHeader:function(t){this.table.header=[{id:"bk_inst_id",type:"checkbox",width:50}].concat(t.map(function(t){return{id:t.bk_property_id,name:t.bk_property_name}}))},handleTableSelect:function(t){var e=this;return p()(l.a.mark(function i(){var n;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if("current"!==t){i.next=4;break}e.table.checked=e.table.list.map(function(t){return t.bk_inst_id}),i.next=8;break;case 4:return i.next=6,e.getAllInstList();case 6:n=i.sent,e.table.checked=n.info.map(function(t){return t.bk_inst_id});case 8:case"end":return i.stop()}},i,e)}))()},handleTableUnselect:function(){this.table.checked=[]},handleRowClick:function(t){this.slider.show=!0,this.slider.title=this.$t("Common['编辑']")+" "+t.bk_inst_name,this.attribute.inst.details=t,this.attribute.type="details"},handleSortChange:function(t){this.table.sort=t,this.handlePageChange(1)},handleSizeChange:function(t){this.table.pagination.size=t,this.handlePageChange(1)},handlePageChange:function(t){this.table.pagination.current=t,this.getTableData()},getInstList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelPrevious:!0};return this.searchInst({objId:this.objId,params:this.getSearchParams(),config:a()({requestId:this.objId+"List"},t)})},getAllInstList:function(){return this.searchInst({objId:this.objId,params:b()({},this.getSearchParams(),{page:{}}),config:{requestId:this.objId+"AllList",cancelPrevious:!0}})},getTableData:function(){var t=this;this.getInstList().then(function(e){return t.table.list=t.$tools.flatternList(t.properties,e.info),t.table.pagination.count=e.count,e})},getSearchParams:function(){var t={condition:s()({},this.objId,[]),fields:{},page:{start:this.table.pagination.size*(this.table.pagination.current-1),limit:this.table.pagination.size,sort:this.table.sort}};if(this.filter.id&&this.filter.value){var e=this.filter.type,i=this.filter.value;if("bool"===e){var n=[!0,!1].find(function(t){return t.toString()===i});i=void 0===n?i:n}else"int"===e&&(i=isNaN(parseInt(i))?i:parseInt(i));if(["bool","int","enum"].includes(e))t.condition[this.objId].push({field:this.filter.id,operator:"$eq",value:i});else if(["singleasst","multiasst"].includes(e)){var o=(this.$tools.getProperty(this.properties,this.filter.id)||{}).bk_asst_obj_id;if(o){var a={host:"bk_host_innerip",biz:"bk_biz_name",plat:"bk_cloud_name",module:"bk_module_name",set:"bk_set_name"};t.condition[o]=[{field:a.hasOwnProperty(o)?a[o]:"bk_inst_name",operator:"$regex",value:i}]}}else t.condition[this.objId].push({field:this.filter.id,operator:"$regex",value:i})}return t},handleEdit:function(t){var e=this;return p()(l.a.mark(function i(){var n,s;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.getInstList({fromCache:!0});case 2:n=i.sent,s=n.info.find(function(e){return e.bk_inst_id===t.bk_inst_id}),e.attribute.inst.edit=s,e.attribute.type="update";case 6:case"end":return i.stop()}},i,e)}))()},handleCreate:function(){this.attribute.type="create",this.attribute.inst.edit={},this.slider.show=!0,this.slider.title=this.$t("Common['创建']")+" "+this.$model.bk_obj_name},handleDelete:function(t){var e=this;this.$bkInfo({title:this.$t("Common['确认要删除']",{name:t.bk_inst_name}),confirmFn:function(){e.deleteInst({objId:e.objId,instId:t.bk_inst_id}).then(function(){e.slider.show=!1,e.$success(e.$t('Common["删除成功"]')),e.handlePageChange(1)})}})},handleSave:function(t,e,i,n){var s=this;"update"===n?this.updateInst({objId:this.objId,instId:i.bk_inst_id,params:t}).then(function(){s.getTableData(),s.handleCancel(),s.$success(s.$t("Common['修改成功']"))}):this.createInst({params:t,objId:this.objId}).then(function(){s.handlePageChange(1),s.handleCancel(),s.$success(s.$t("Inst['创建成功']"))})},handleCancel:function(){"create"===this.attribute.type?this.slider.show=!1:this.attribute.type="details"},handleMultipleEdit:function(){this.attribute.type="multiple",this.slider.title=this.$t("Inst['批量更新']"),this.slider.show=!0},handleMultipleSave:function(t){var e=this;this.batchUpdateInst({objId:this.objId,params:{update:this.table.checked.map(function(e){return{datas:t,inst_id:e}})},config:{requestId:this.objId+"BatchUpdate"}}).then(function(){e.$success(e.$t('Common["修改成功"]')),e.handlePageChange(1)})},handleMultipleCancel:function(){this.slider.show=!1},handleMultipleDelete:function(){var t=this;this.$bkInfo({title:this.$t("Common['确定删除选中的实例']"),confirmFn:function(){t.doBatchDeleteInst()}})},doBatchDeleteInst:function(){var t=this;this.batchDeleteInst({objId:this.objId,config:{data:{delete:{inst_ids:this.table.checked}}}}).then(function(){t.$success(t.$t('Common["删除成功"]')),t.table.checked=[],t.handlePageChange(1)})},handleApplyColumnsConfig:function(t){this.$store.dispatch("userCustom/saveUsercustom",s()({},this.objId+"_table_columns",t.map(function(t){return t.bk_property_id}))),this.columnsConfig.show=!1},handleResetColumnsConfig:function(){this.$store.dispatch("userCustom/saveUsercustom",s()({},this.objId+"_table_columns",[])),this.columnsConfig.show=!1},routeToHistory:function(){this.$router.push("/history/"+this.objId+"?relative=/general-model/"+this.objId)}})},_={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"models-layout"},[i("div",{staticClass:"models-options clearfix"},[i("div",{staticClass:"options-button fl"},[i("cmdb-table-selector",{staticClass:"models-table-selector",attrs:{disabled:t.$loading()||!t.table.pagination.count,total:t.table.pagination.count,"selected-count":t.table.checked.length},on:{"on-cancel":t.handleTableUnselect,"on-select":t.handleTableSelect}}),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("ModelManagement['导入']"),expression:"$t('ModelManagement[\\'导入\\']')"}],staticClass:"models-button"},[i("i",{staticClass:"icon-cc-import"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("ModelManagement['导出']"),expression:"$t('ModelManagement[\\'导出\\']')"}],staticClass:"models-button",attrs:{type:"default submit",form:"exportForm",disabled:!t.table.checked.length}},[i("i",{staticClass:"icon-cc-derivation"})]),t._v(" "),i("form",{attrs:{id:"exportForm",action:t.url.export,method:"POST",hidden:""}},[i("input",{attrs:{type:"hidden",name:"bk_inst_id"},domProps:{value:t.table.checked.join(",")}})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Inst['批量更新']"),expression:"$t('Inst[\\'批量更新\\']')"}],staticClass:"models-button",attrs:{disabled:!t.table.checked.length},on:{click:t.handleMultipleEdit}},[i("i",{staticClass:"icon-cc-edit"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Common['删除']"),expression:"$t('Common[\\'删除\\']')"}],staticClass:"models-button",attrs:{disabled:!t.table.checked.length},on:{click:t.handleMultipleDelete}},[i("i",{staticClass:"icon-cc-del"})]),t._v(" "),i("bk-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("Inst['立即创建']")))])],1),t._v(" "),i("div",{staticClass:"options-button fr"},[i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Common['查看删除历史']"),expression:"$t('Common[\\'查看删除历史\\']')"}],on:{click:t.routeToHistory}},[i("i",{staticClass:"icon-cc-history"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("BusinessTopology['列表显示属性配置']"),expression:"$t('BusinessTopology[\\'列表显示属性配置\\']')"}],staticClass:"button-setting",on:{click:function(e){t.columnsConfig.show=!0}}},[i("i",{staticClass:"icon-cc-setting"})])],1),t._v(" "),i("div",{staticClass:"options-filter clearfix fr"},[i("bk-selector",{staticClass:"filter-selector fl",attrs:{searchable:!0,list:t.filter.options,selected:t.filter.id},on:{"update:selected":function(e){t.$set(t.filter,"id",e)}}}),t._v(" "),"enum"===t.filter.type?i("cmdb-form-enum",{staticClass:"filter-value fl",attrs:{options:t.$tools.getEnumOptions(t.properties,t.filter.id),"allow-clear":!0},on:{"on-selected":t.getTableData},model:{value:t.filter.value,callback:function(e){t.$set(t.filter,"value",e)},expression:"filter.value"}}):"int"===t.filter.type?i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.filter.value,expression:"filter.value",modifiers:{number:!0}}],staticClass:"filter-value bk-form-input fl",attrs:{type:"text",maxlength:"11",placeholder:t.$t("Common['快速查询']")},domProps:{value:t.filter.value},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.getTableData(e):null},input:function(e){e.target.composing||t.$set(t.filter,"value",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}):i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.filter.value,expression:"filter.value",modifiers:{trim:!0}}],staticClass:"filter-value bk-form-input fl",attrs:{type:"text",placeholder:t.$t("Common['快速查询']")},domProps:{value:t.filter.value},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.getTableData(e):null},input:function(e){e.target.composing||t.$set(t.filter,"value",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:"enum"!==t.filter.type,expression:"filter.type !== 'enum'"}],staticClass:"filter-search bk-icon icon-search",on:{click:t.getTableData}})],1)]),t._v(" "),i("cmdb-table",{ref:"table",staticClass:"models-table",attrs:{loading:t.$loading(),checked:t.table.checked,header:t.table.header,list:t.table.list,pagination:t.table.pagination,defaultSort:t.table.defaultSort,wrapperMinusHeight:157},on:{"update:checked":function(e){t.$set(t.table,"checked",e)},"update:pagination":function(e){t.$set(t.table,"pagination",e)},handleRowClick:t.handleRowClick,handleSortChange:t.handleSortChange,handleSizeChange:t.handleSizeChange,handlePageChange:t.handlePageChange}}),t._v(" "),i("cmdb-slider",{attrs:{isShow:t.slider.show,title:t.slider.title},on:{"update:isShow":function(e){t.$set(t.slider,"show",e)}}},[i("bk-tab",{attrs:{slot:"content","active-name":t.tab.active},on:{"update:activeName":function(e){t.$set(t.tab,"active",e)}},slot:"content"},[i("bk-tabpanel",{attrs:{name:"attribute",title:t.$t("Common['属性']")}},["details"===t.attribute.type?i("cmdb-details",{attrs:{properties:t.properties,propertyGroups:t.propertyGroups,inst:t.attribute.inst.details},on:{"on-edit":t.handleEdit,"on-delete":t.handleDelete}}):["update","create"].includes(t.attribute.type)?i("cmdb-form",{attrs:{properties:t.properties,propertyGroups:t.propertyGroups,inst:t.attribute.inst.edit,type:t.attribute.type},on:{"on-submit":t.handleSave,"on-cancel":t.handleCancel}}):"multiple"===t.attribute.type?i("cmdb-form-multiple",{attrs:{properties:t.properties,propertyGroups:t.propertyGroups},on:{"on-submit":t.handleMultipleSave,"on-cancel":t.handleMultipleCancel}}):t._e()],1),t._v(" "),i("bk-tabpanel",{attrs:{name:"relevance",title:t.$t("HostResourcePool['关联']")}}),t._v(" "),i("bk-tabpanel",{attrs:{name:"history",title:t.$t("HostResourcePool['变更记录']")}},["history"===t.tab.active?i("cmdb-audit-history",{attrs:{target:t.objId,instId:t.attribute.inst.details.bk_inst_id}}):t._e()],1)],1)],1),t._v(" "),i("cmdb-slider",{attrs:{isShow:t.columnsConfig.show,width:600,title:t.$t("BusinessTopology['列表显示属性配置']")},on:{"update:isShow":function(e){t.$set(t.columnsConfig,"show",e)}}},[i("cmdb-columns-config",{attrs:{slot:"content",properties:t.properties,selected:t.columnsConfig.selected},on:{"on-apply":t.handleApplyColumnsConfig,"on-cancel":function(e){t.columnsConfig.show=!1},"on-reset":t.handleResetColumnsConfig},slot:"content"})],1)],1)},staticRenderFns:[]};var C=i("VU/8")(g,_,!1,function(t){i("Y5U0")},"data-v-3dfe493a",null);e.default=C.exports},Y5U0:function(t,e){}});
//# sourceMappingURL=10.08e7a9ff940a2da31b68.js.map