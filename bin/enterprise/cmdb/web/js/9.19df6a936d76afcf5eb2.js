webpackJsonp([9],{jPcV:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("woOf"),n=i.n(s),a=i("Xxa5"),o=i.n(a),r=i("//Fk"),l=i.n(r),u=i("exGp"),c=i.n(u),p=i("Dd8w"),d=i.n(p),h=i("NYxO"),b=i("BZR1"),f=i("k43u"),m={components:{cmdbColumnsConfig:b.a,cmdbAuditHistory:f.a},data:function(){return{properties:[],propertyGroups:[],table:{header:[],list:[],pagination:{count:0,size:10,current:1},defaultSort:"bk_biz_id",sort:"bk_biz_id"},filter:{id:"",value:"",type:"",options:[]},slider:{show:!1,title:""},tab:{active:"attribute"},attribute:{type:null,inst:{}},columnsConfig:{show:!1,selected:[]}}},computed:d()({},Object(h.c)(["supplierAccount"]),Object(h.c)("userCustom",["usercustom"]),{customBusinessColumns:function(){return this.usercustom.biz_table_columns||[]}}),watch:{"filter.id":function(t){this.filter.value="",this.filter.type=(this.$tools.getProperty(this.properties,t)||{}).bk_property_type},customBusinessColumns:function(){this.setTableHeader()}},created:function(){var t=this;return c()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.searchObjectAttribute({params:{bk_obj_id:"biz",bk_supplier_account:t.supplierAccount},config:{requestId:"bizAttribute",fromCache:!0}});case 3:return t.properties=e.sent,e.next=6,l.a.all([t.getPropertyGroups(),t.setTableHeader(),t.setFilterOptions()]);case 6:t.getTableData(),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}},e,t,[[0,9]])}))()},methods:d()({},Object(h.b)("objectModelFieldGroup",["searchGroup"]),Object(h.b)("objectModelProperty",["searchObjectAttribute"]),Object(h.b)("objectBiz",["searchBusiness","archiveBusiness","updateBusiness","createBusiness"]),{getPropertyGroups:function(){var t=this;return this.searchGroup({objId:"biz",config:{fromCache:!0,requestId:"searchBizGroup"}}).then(function(e){return t.propertyGroups=e,e})},setTableHeader:function(){var t=this;return new l.a(function(e,i){e(t.$tools.getHeaderProperties(t.properties,t.customBusinessColumns))}).then(function(e){t.updateTableHeader(e),t.columnsConfig.selected=e.map(function(t){return t.bk_property_id})})},setFilterOptions:function(){this.filter.options=this.properties.map(function(t){return{id:t.bk_property_id,name:t.bk_property_name}}),this.filter.id=this.filter.options.length?this.filter.options[0].id:""},updateTableHeader:function(t){this.table.header=[{id:"bk_biz_id",name:"ID"}].concat(t.map(function(t){return{id:t.bk_property_id,name:t.bk_property_name}}))},handleRowClick:function(t){this.slider.show=!0,this.slider.title=this.$t("Common['编辑']")+" "+t.bk_biz_name,this.attribute.inst.details=t,this.attribute.type="details"},handleSortChange:function(t){this.table.sort=t,this.handlePageChange(1)},handleSizeChange:function(t){this.table.pagination.size=t,this.handlePageChange(1)},handlePageChange:function(t){this.table.pagination.current=t,this.getTableData()},getBusinessList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelPrevious:!0};return this.searchBusiness({params:this.getSearchParams(),config:n()({requestId:"requestBusiness"},t)})},getTableData:function(){var t=this;this.getBusinessList().then(function(e){return t.table.list=t.$tools.flatternList(t.properties,e.info),t.table.pagination.count=e.count,e})},getSearchParams:function(){var t={condition:{bk_data_status:{$ne:"disabled"}},fields:[],page:{start:this.table.pagination.size*(this.table.pagination.current-1),limit:this.table.pagination.size,sort:this.table.sort}};if(this.filter.id&&this.filter.value){var e=this.filter.type,i=this.filter.value;if("bool"===e){var s=[!0,!1].find(function(t){return t.toString()===i});i=void 0===s?i:s}else"int"===e&&(i=isNaN(parseInt(i))?i:parseInt(i));t.condition[this.filter.id]=i}return t},handleEdit:function(t){var e=this;return c()(o.a.mark(function i(){var s,n;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.getBusinessList({fromCache:!0});case 2:s=i.sent,n=s.info.find(function(e){return e.bk_biz_id===t.bk_biz_id}),e.attribute.inst.edit=n,e.attribute.type="update";case 6:case"end":return i.stop()}},i,e)}))()},handleCreate:function(){this.attribute.type="create",this.attribute.inst.edit={},this.slider.show=!0,this.slider.title=this.$t("Common['创建']")+" "+this.$model.bk_obj_name},handleDelete:function(t){var e=this;this.$bkInfo({title:this.$t("Common['确认要归档']",{name:t.bk_biz_name}),confirmFn:function(){e.archiveBusiness(t.bk_biz_id).then(function(){e.slider.show=!1,e.$success(e.$t('Common["归档成功"]')),e.handlePageChange(1)})}})},handleSave:function(t,e,i,s){var n=this;"update"===s?this.updateBusiness({bizId:i.bk_biz_id,params:t}).then(function(){n.getTableData(),n.handleCancel(),n.$success(n.$t("Common['修改成功']"))}):this.createBusiness({params:t}).then(function(){n.handlePageChange(1),n.handleCancel(),n.$success(n.$t("Inst['创建成功']"))})},handleCancel:function(){"create"===this.attribute.type?this.slider.show=!1:this.attribute.type="details"},handleApplayColumnsConfig:function(t){this.$store.dispatch("userCustom/saveUsercustom",{biz_table_columns:t.map(function(t){return t.bk_property_id})}),this.columnsConfig.show=!1},handleResetColumnsConfig:function(){this.$store.dispatch("userCustom/saveUsercustom",{biz_table_columns:[]}),this.columnsConfig.show=!1},routeToHistory:function(){this.$router.push("/history/biz?relative=/business")}})},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"business-layout"},[i("div",{staticClass:"business-options clearfix"},[i("bk-button",{staticClass:"fl",attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("Inst['立即创建']")))]),t._v(" "),i("div",{staticClass:"options-button fr"},[i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:t.$t("Common['查看删除历史']"),expression:"$t('Common[\\'查看删除历史\\']')",modifiers:{bottom:!0}}],staticClass:"button-history",on:{click:t.routeToHistory}},[i("i",{staticClass:"icon-cc-history2"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip.bottom",value:t.$t("BusinessTopology['列表显示属性配置']"),expression:"$t('BusinessTopology[\\'列表显示属性配置\\']')",modifiers:{bottom:!0}}],staticClass:"button-setting",on:{click:function(e){t.columnsConfig.show=!0}}},[i("i",{staticClass:"icon-cc-setting"})])],1),t._v(" "),i("div",{staticClass:"options-filter clearfix fr"},[i("bk-selector",{staticClass:"filter-selector fl",attrs:{searchable:!0,list:t.filter.options,selected:t.filter.id},on:{"update:selected":function(e){t.$set(t.filter,"id",e)}}}),t._v(" "),"enum"===t.filter.type?i("cmdb-form-enum",{staticClass:"filter-value fl",attrs:{options:t.$tools.getEnumOptions(t.properties,t.filter.id),"allow-clear":!0},on:{"on-selected":t.getTableData},model:{value:t.filter.value,callback:function(e){t.$set(t.filter,"value",e)},expression:"filter.value"}}):"int"===t.filter.type?i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.filter.value,expression:"filter.value",modifiers:{number:!0}}],staticClass:"filter-value bk-form-input fl",attrs:{type:"text",maxlength:"11",placeholder:t.$t("Common['快速查询']")},domProps:{value:t.filter.value},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.getTableData(e):null},input:function(e){e.target.composing||t.$set(t.filter,"value",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}):i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.filter.value,expression:"filter.value",modifiers:{trim:!0}}],staticClass:"filter-value bk-form-input fl",attrs:{type:"text",placeholder:t.$t("Common['快速查询']")},domProps:{value:t.filter.value},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.getTableData(e):null},input:function(e){e.target.composing||t.$set(t.filter,"value",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:"enum"!==t.filter.type,expression:"filter.type !== 'enum'"}],staticClass:"filter-search bk-icon icon-search",on:{click:t.getTableData}})],1)],1),t._v(" "),i("cmdb-table",{ref:"table",staticClass:"business-table",attrs:{loading:t.$loading("requestBusiness"),header:t.table.header,list:t.table.list,pagination:t.table.pagination,defaultSort:t.table.defaultSort,wrapperMinusHeight:157},on:{"update:pagination":function(e){t.$set(t.table,"pagination",e)},handleRowClick:t.handleRowClick,handleSortChange:t.handleSortChange,handleSizeChange:t.handleSizeChange,handlePageChange:t.handlePageChange}}),t._v(" "),i("cmdb-slider",{attrs:{isShow:t.slider.show,title:t.slider.title},on:{"update:isShow":function(e){t.$set(t.slider,"show",e)}}},[i("bk-tab",{staticStyle:{padding:"0 20px"},attrs:{slot:"content","active-name":t.tab.active},on:{"update:activeName":function(e){t.$set(t.tab,"active",e)}},slot:"content"},[i("bk-tabpanel",{attrs:{name:"attribute",title:t.$t("Common['属性']")}},["details"===t.attribute.type?i("cmdb-details",{attrs:{properties:t.properties,propertyGroups:t.propertyGroups,inst:t.attribute.inst.details,deleteButtonText:t.$t("Inst['归档']")},on:{"on-edit":t.handleEdit,"on-delete":t.handleDelete}}):["update","create"].includes(t.attribute.type)?i("cmdb-form",{attrs:{properties:t.properties,propertyGroups:t.propertyGroups,inst:t.attribute.inst.edit,type:t.attribute.type},on:{"on-submit":t.handleSave,"on-cancel":t.handleCancel}}):t._e()],1),t._v(" "),i("bk-tabpanel",{attrs:{name:"relevance",title:t.$t("HostResourcePool['关联']")}}),t._v(" "),i("bk-tabpanel",{attrs:{name:"history",title:t.$t("HostResourcePool['变更记录']")}},["history"===t.tab.active?i("cmdb-audit-history",{attrs:{target:"biz",instId:t.attribute.inst.details.bk_biz_id}}):t._e()],1)],1)],1),t._v(" "),i("cmdb-slider",{attrs:{isShow:t.columnsConfig.show,width:600,title:t.$t("BusinessTopology['列表显示属性配置']")},on:{"update:isShow":function(e){t.$set(t.columnsConfig,"show",e)}}},[i("cmdb-columns-config",{attrs:{slot:"content",properties:t.properties,selected:t.columnsConfig.selected},on:{"on-apply":t.handleApplayColumnsConfig,"on-cancel":function(e){t.columnsConfig.show=!1},"on-reset":t.handleResetColumnsConfig},slot:"content"})],1)],1)},staticRenderFns:[]};var g=i("VU/8")(m,v,!1,function(t){i("vd5K")},"data-v-5ec3fefa",null);e.default=g.exports},vd5K:function(t,e){}});
//# sourceMappingURL=9.19df6a936d76afcf5eb2.js.map