webpackJsonp([2],{"0fZ5":function(t,e,i){"use strict";var o=i("bOdI"),s=i.n(o),n=i("Xxa5"),r=i.n(n),a=i("exGp"),l=i.n(a),c=i("Gu7T"),u=i.n(c),p=i("fZjL"),d=i.n(p),f=i("Dd8w"),h=i.n(f),b=i("NYxO"),_=i("lHA8"),m=i.n(_),v={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("bk-selector",{attrs:{list:t.list,selected:t.localSelected},on:{"update:selected":function(e){t.localSelected=e}}})},staticRenderFns:[]},k={components:{filterFieldOperator:i("VU/8")({props:["value","type"],data:function(){return{operatorMap:{common:[{id:"$eq",name:this.$t("Common['等于']")},{id:"$ne",name:this.$t("Common['不等于']")}],char:[{id:"$regex",name:this.$t("Common['包含']")},{id:"$eq",name:this.$t("Common['等于']")},{id:"$ne",name:this.$t("Common['不等于']")}],name:[{id:"$in",name:"IN"},{id:"$eq",name:this.$t("Common['等于']")},{id:"$ne",name:this.$t("Common['不等于']")}]},localSelected:""}},computed:{list:function(){var t=this.type;return this.operatorMap.hasOwnProperty(t)||(t="common"),this.operatorMap[t]}},watch:{value:function(t){this.setLocalSelected()},localSelected:function(t){this.$emit("input",t),this.$emit("on-selected",t)}},created:function(){this.setLocalSelected()},methods:{setLocalSelected:function(){this.value?this.localSelected=this.value:this.localSelected=this.list[0].id}}},v,!1,null,null,null).exports},props:{filterConfigKey:{type:String,required:!0}},data:function(){return{properties:{biz:[],host:[],set:[],module:[]},ip:{text:"",bk_host_innerip:!0,bk_host_outerip:!0,exact:0},condition:{},associateFieldMap:{biz:"bk_biz_name",plat:"bk_cloud_name",module:"bk_module_name",set:"bk_set_name"}}},computed:h()({},Object(b.c)("userCustom",["usercustom"]),{customFields:function(){return this.usercustom[this.filterConfigKey]||[]},customFieldProperties:function(){var t=this,e=[];return this.customFields.forEach(function(i){var o=i.bk_obj_id,s=i.bk_property_id,n=t.$tools.getProperty(t.properties[o],s);n&&e.push(n)}),e},ipArray:function(){var t=[];return this.ip.text.split(/\n|;|；|,|，/).forEach(function(e){e.trim().length&&t.push(e.trim())}),t}}),watch:{customFieldProperties:function(){this.setCondition()}},created:function(){var t=this;return l()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getProperties();case 2:t.refresh();case 3:case"end":return e.stop()}},e,t)}))()},methods:h()({},Object(b.b)("objectModelProperty",["batchSearchObjectAttribute"]),{getProperties:function(){var t=this;return this.batchSearchObjectAttribute({params:{bk_obj_id:{$in:d()(this.properties)},bk_supplier_account:this.supplierAccount},config:{requestId:"hostsAttribute",fromCache:!0}}).then(function(e){return d()(t.properties).forEach(function(i){t.properties[i]=e[i]}),e})},getFilterLabel:function(t){var e=t.bk_obj_id;return this.$allModels.find(function(t){return t.bk_obj_id===e}).bk_obj_name+" - "+t.bk_property_name},getOperatorType:function(t){var e=t.bk_property_type,i=t.bk_property_id;return["bk_set_name","bk_module_name"].includes(i)?"name":["singlechar","longchar"].includes(e)?"char":"common"},getConditionOperator:function(t){return this.condition[t.bk_obj_id].find(function(e){return e.field===t.bk_property_id}).operator},getParams:function(){var t=this,e={ip:{flag:["bk_host_innerip","bk_host_outerip"].filter(function(e){return t.ip[e]}).join("|"),exact:this.ip.exact,data:this.ipArray},condition:[]},i=this.customFieldProperties.filter(function(t){return!["singleasst","multiasst"].includes(t.bk_property_type)});return["biz","host","set","module"].forEach(function(o){var s={bk_obj_id:o,condition:[],fields:[]};i.filter(function(t){return t.bk_obj_id===o}).forEach(function(e){var i=t.condition[o][e.bk_property_id],n=i.value;if(!["",null].includes(n)){if("$in"===i.operator){var r=[].concat(u()(new m.a(n.split(",").map(function(t){return t.trim()}))));n=r.length>1?[].concat(u()(r),[n]):r}s.condition.push(h()({},i,{value:n}))}}),e.condition.push(s)}),this.customFieldProperties.filter(function(t){return["singleasst","multiasst"].includes(t.bk_property_type)}).forEach(function(i){var o=i.bk_asst_obj_id,s=t.condition[i.bk_obj_id][i.bk_property_id];if(o&&!["",null].includes(s.value)){var n=e.condition.find(function(t){return t.bk_obj_id===o});n||(n={bk_obj_id:o,condition:[],fields:[]},e.condition.push(n)),n.condition.push({field:t.associateFieldMap[o]||"bk_inst_name",operator:s.operator,value:s.value})}}),e},setCondition:function(){var t={host:{},set:{},module:{}};this.customFieldProperties.forEach(function(e){t[e.bk_obj_id][e.bk_property_id]={field:e.bk_property_id,operator:"",value:""}}),this.condition=t},reset:function(){for(var t in this.ip={text:"",bk_host_innerip:!0,bk_host_outerip:!0,exact:0},this.condition)for(var e in this.condition[t])this.condition[t][e].operator="",this.condition[t][e].value="";this.refresh()},refresh:function(){this.$emit("on-refresh",this.getParams())}})},y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-layout"},[t._t("business"),t._v(" "),i("div",{staticClass:"filter-group"},[i("label",{staticClass:"filter-label",attrs:{for:"filterIp"}},[t._v("IP")]),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.ip.text,expression:"ip.text",modifiers:{trim:!0}}],staticClass:"filter-field filter-field-ip",attrs:{id:"filterIp"},domProps:{value:t.ip.text},on:{input:function(e){e.target.composing||t.$set(t.ip,"text",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("cmdb-form-bool",{staticClass:"filter-field-bool",attrs:{disabled:!t.ip.bk_host_outerip},model:{value:t.ip.bk_host_innerip,callback:function(e){t.$set(t.ip,"bk_host_innerip",e)},expression:"ip.bk_host_innerip"}},[i("span",{staticClass:"filter-field-bool-label"},[t._v(t._s(t.$t("HostResourcePool['内网']")))])]),t._v(" "),i("cmdb-form-bool",{staticClass:"filter-field-bool",attrs:{disabled:!t.ip.bk_host_innerip},model:{value:t.ip.bk_host_outerip,callback:function(e){t.$set(t.ip,"bk_host_outerip",e)},expression:"ip.bk_host_outerip"}},[i("span",{staticClass:"filter-field-bool-label"},[t._v(t._s(t.$t("HostResourcePool['外网']")))])]),t._v(" "),i("cmdb-form-bool",{staticClass:"filter-field-bool",attrs:{"true-value":1,"false-value":0},model:{value:t.ip.exact,callback:function(e){t.$set(t.ip,"exact",e)},expression:"ip.exact"}},[i("span",{staticClass:"filter-field-bool-label"},[t._v(t._s(t.$t("HostResourcePool['精确']")))])])],1),t._v(" "),t._t("scope"),t._v(" "),t._l(t.customFieldProperties,function(e,o){return i("div",{key:o,staticClass:"filter-group"},[i("label",{staticClass:"filter-label"},[t._v(t._s(t.getFilterLabel(e)))]),t._v(" "),i("div",{staticClass:"filter-field clearfix"},[["date","time"].includes(e.bk_property_type)?t._e():i("filter-field-operator",{staticClass:"filter-field-operator fl",attrs:{type:t.getOperatorType(e)},model:{value:t.condition[e.bk_obj_id][e.bk_property_id].operator,callback:function(i){t.$set(t.condition[e.bk_obj_id][e.bk_property_id],"operator",i)},expression:"condition[property['bk_obj_id']][property['bk_property_id']]['operator']"}}),t._v(" "),"enum"===e.bk_property_type?i("cmdb-form-enum",{staticClass:"filter-field-value fr",attrs:{"allow-clear":!0,options:e.option||[]},model:{value:t.condition[e.bk_obj_id][e.bk_property_id].value,callback:function(i){t.$set(t.condition[e.bk_obj_id][e.bk_property_id],"value",i)},expression:"condition[property['bk_obj_id']][property['bk_property_id']]['value']"}}):"bool"===e.bk_property_type?i("cmdb-form-bool-input",{staticClass:"filter-field-value filter-field-bool-input fr",model:{value:t.condition[e.bk_obj_id][e.bk_property_id].value,callback:function(i){t.$set(t.condition[e.bk_obj_id][e.bk_property_id],"value",i)},expression:"condition[property['bk_obj_id']][property['bk_property_id']]['value']"}}):["singleasst","multiasst"].includes(e.bk_property_type)?i("cmdb-form-associate-input",{staticClass:"filter-field-value filter-field-associate fr",model:{value:t.condition[e.bk_obj_id][e.bk_property_id].value,callback:function(i){t.$set(t.condition[e.bk_obj_id][e.bk_property_id],"value",i)},expression:"condition[property['bk_obj_id']][property['bk_property_id']]['value']"}}):i("cmdb-form-"+e.bk_property_type,{tag:"component",staticClass:"filter-field-value fr",class:"filter-field-"+e.bk_property_type,model:{value:t.condition[e.bk_obj_id][e.bk_property_id].value,callback:function(i){t.$set(t.condition[e.bk_obj_id][e.bk_property_id],"value",i)},expression:"condition[property['bk_obj_id']][property['bk_property_id']]['value']"}})],1)])}),t._v(" "),i("div",{staticClass:"filter-button"},[i("bk-button",{attrs:{type:"primary",disabled:t.$loading()},on:{click:t.refresh}},[t._v(t._s(t.$t("HostResourcePool['刷新查询']")))])],1)],2)},staticRenderFns:[]};var g=i("VU/8")(k,y,!1,function(t){i("VB70")},"data-v-35e892dd",null).exports,C={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"collection-layout"})},staticRenderFns:[]};var $=i("VU/8")({},C,!1,function(t){i("uioc")},"data-v-6efa33fc",null).exports,x={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"history-layout"})},staticRenderFns:[]};var w=i("VU/8")({},x,!1,function(t){i("pJGF")},"data-v-5b1a06f0",null).exports,S=i("DAYN"),P={name:"cmdb-filter-config",components:{vueDraggable:i.n(S).a},props:{properties:{type:Object,default:function(){return{}}},selected:{type:Array,default:function(){return[]}},min:{type:Number,default:0},max:{type:Number,default:10}},data:function(){return{filter:"",selectedModel:"",localSelcted:[]}},computed:{modelOptions:function(){var t=this;return d()(this.properties).map(function(e){var i=t.$allModels.find(function(t){return t.bk_obj_id===e})||{};return{id:e,name:i.bk_obj_name}})},sortedProperties:function(){var t=this.properties[this.selectedModel]||[];return[].concat(u()(t)).sort(function(t,e){return t.bk_property_name.localeCompare(e.bk_property_name,"zh-Hans-CN",{sensitivity:"accent"})})},unselectedProperties:function(){var t=this;return this.sortedProperties.filter(function(e){return t.checkAvaliable(e)&&!t.localSelcted.some(function(t){return t.bk_property_id===e.bk_property_id})})},selectedProperties:{get:function(){var t=this;return this.localSelcted.map(function(e){return t.properties[e.bk_obj_id].find(function(t){return t.bk_property_id===e.bk_property_id})})},set:function(t){this.localSelcted=t.map(function(t){return{bk_property_id:t.bk_property_id,bk_obj_id:t.bk_obj_id}})}}},watch:{selected:function(t){this.initLocalSelected()},filter:function(t){var e=this;this.unselectedProperties.forEach(function(i,o){-1!==i.bk_property_name.toLowerCase().indexOf(t.toLowerCase())?e.$refs.unselectedPropertyItem[o].style.display="block":e.$refs.unselectedPropertyItem[o].style.display="none"})}},created:function(){this.initLocalSelected()},methods:{initLocalSelected:function(){var t=this;this.localSelcted=this.selected.filter(function(e){return(t.properties[e.bk_obj_id]||[]).some(function(i){return i.bk_property_id===e.bk_property_id&&t.checkAvaliable(i)})})},checkAvaliable:function(t){return!(["bk_host_innerip","bk_host_outerip"].includes(t.bk_property_id)||t.bk_isapi)},selectProperty:function(t){this.localSelcted.length<this.max?this.localSelcted.push({bk_property_id:t.bk_property_id,bk_obj_id:t.bk_obj_id}):this.$info(this.$t('Common["最多选择N项"]',{n:this.max}))},unselectProperty:function(t){this.localSelcted.length>this.min?this.localSelcted=this.localSelcted.filter(function(e){return e.bk_property_id!==t.bk_property_id}):this.$info(this.$t('Common["至少选择N项"]',{n:this.min}))},handleApply:function(){this.localSelcted.length>this.max?this.$info(this.$t('Common["最多选择N项"]',{n:this.max})):this.localSelcted.length<this.min?this.$info(this.$t('Common["至少选择N项"]',{n:this.min})):this.$emit("on-apply",this.selectedProperties)},handleCancel:function(){this.$emit("on-cancel")}}},j={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"config-layout clearfix"},[i("div",{staticClass:"config-wrapper config-unselected fl"},[i("div",{staticClass:"wrapper-header unselected-header"},[i("cmdb-selector",{staticClass:"header-selector",attrs:{list:t.modelOptions},model:{value:t.selectedModel,callback:function(e){t.selectedModel="string"==typeof e?e.trim():e},expression:"selectedModel"}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.filter,expression:"filter",modifiers:{trim:!0}}],staticClass:"header-filter",attrs:{type:"text",placeholder:t.$t("Inst['搜索属性']")},domProps:{value:t.filter},on:{input:function(e){e.target.composing||(t.filter=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})],1),t._v(" "),i("ul",{staticClass:"property-list"},t._l(t.unselectedProperties,function(e,o){return i("li",{ref:"unselectedPropertyItem",refInFor:!0,staticClass:"property-item",on:{click:function(i){t.selectProperty(e)}}},[i("span",[t._v(t._s(e.bk_property_name))]),t._v(" "),i("i",{staticClass:"bk-icon icon-angle-right"})])}))]),t._v(" "),i("div",{staticClass:"config-wrapper config-selected fl"},[i("div",{staticClass:"wrapper-header selected-header"},[i("label",{staticClass:"header-label"},[t._v(t._s(t.$t("Inst['已显示属性']")))])]),t._v(" "),i("vue-draggable",{staticClass:"property-list property-list-selected",attrs:{element:"ul",options:{animation:150}},model:{value:t.selectedProperties,callback:function(e){t.selectedProperties=e},expression:"selectedProperties"}},t._l(t.selectedProperties,function(e,o){return i("li",{staticClass:"property-item"},[i("i",{staticClass:"icon-triple-dot"}),t._v(" "),i("span",[t._v(t._s(e.bk_property_name))]),t._v(" "),i("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Common['隐藏']"),expression:"$t('Common[\\'隐藏\\']')"}],staticClass:"bk-icon icon-eye-slash-shape",on:{click:function(i){t.unselectProperty(e)}}})])}))],1),t._v(" "),i("div",{staticClass:"config-options clearfix"},[i("bk-button",{staticClass:"config-button fl",attrs:{type:"primary"},on:{click:t.handleApply}},[t._v(t._s(t.$t("Inst['应用']")))]),t._v(" "),i("bk-button",{staticClass:"config-button fl",attrs:{type:"default"},on:{click:t.handleCancel}},[t._v(t._s(t.$t("Common['取消']")))])],1)])},staticRenderFns:[]};var H={components:{cmdbFilterConfig:i("VU/8")(P,j,!1,function(t){i("302L")},"data-v-32156e17",null).exports},props:{activeSetting:{type:Array,default:function(){return["reset","collection","filter-config"]}},filterConfigKey:{type:String,required:!0}},data:function(){return{filterConfig:{show:!1,properties:{biz:[],host:[],set:[],module:[]}}}},computed:h()({},Object(b.c)(["supplierAccount"]),Object(b.c)("userCustom",["usercustom"]),{customFilterFields:function(){return this.usercustom[this.filterConfigKey]||[]}}),created:function(){var t=this;return l()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getProperties();case 2:case"end":return e.stop()}},e,t)}))()},methods:h()({},Object(b.b)("objectModelProperty",["batchSearchObjectAttribute"]),{getProperties:function(){var t=this;return this.batchSearchObjectAttribute({params:{bk_obj_id:{$in:d()(this.filterConfig.properties)},bk_supplier_account:this.supplierAccount},config:{requestId:"hostsAttribute",fromCache:!0}}).then(function(e){return d()(t.filterConfig.properties).forEach(function(i){t.filterConfig.properties[i]=e[i]}),t.$delete(t.filterConfig.properties,"biz"),e})},handleApplyFilterConfig:function(t){this.$store.dispatch("userCustom/saveUsercustom",s()({},this.filterConfigKey,t.map(function(t){return{bk_property_id:t.bk_property_id,bk_obj_id:t.bk_obj_id}}))),this.filterConfig.show=!1},handleReset:function(){this.$emit("on-reset")}})},R={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"setting-layout"},[t.activeSetting.includes("reset")?i("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("HostResourcePool['清空查询条件']"),expression:"$t('HostResourcePool[\\'清空查询条件\\']')"}],staticClass:"setting-icon icon-cc-broom",on:{click:t.handleReset}}):t._e(),t._v(" "),t.activeSetting.includes("collection")?i("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Hosts['收藏']"),expression:"$t('Hosts[\\'收藏\\']')"}],staticClass:"setting-icon icon-cc-collection"}):t._e(),t._v(" "),t.activeSetting.includes("filter-config")?i("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("HostResourcePool['设置筛选项']"),expression:"$t('HostResourcePool[\\'设置筛选项\\']')"}],staticClass:"setting-icon icon-cc-funnel",on:{click:function(e){t.filterConfig.show=!0}}}):t._e(),t._v(" "),i("cmdb-slider",{attrs:{"is-show":t.filterConfig.show,title:t.$t("HostResourcePool['主机筛选项设置']"),width:600},on:{"update:isShow":function(e){t.$set(t.filterConfig,"show",e)}}},[i("cmdb-filter-config",{attrs:{slot:"content",properties:t.filterConfig.properties,selected:t.customFilterFields},on:{"on-cancel":function(e){t.filterConfig.show=!1},"on-apply":t.handleApplyFilterConfig},slot:"content"})],1)],1)},staticRenderFns:[]};var A={components:{theFilter:g,theCollection:$,theHistory:w,theSetting:i("VU/8")(H,R,!1,function(t){i("1hcu")},"data-v-1486083c",null).exports},props:{activeTab:{type:Array,default:function(){return["filter","collection","history"]}},activeSetting:{type:Array,default:function(){return["reset","collection","filter-config"]}},filterConfigKey:{type:String,required:!0}},data:function(){return{close:!1,tab:{active:"filter"}}},methods:{handleReset:function(){this.$refs.theFilter.reset()},handleRefresh:function(t){this.$emit("on-refresh",t)}}},O={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"hosts-filter-layout",class:{close:t.close}},[i("i",{staticClass:"filter-toggle bk-icon icon-angle-right",on:{click:function(e){t.close=!t.close}}}),t._v(" "),i("div",{staticClass:"filter-main"},[i("bk-tab",{staticClass:"filter-tab",attrs:{size:"small","active-name":t.tab.active},on:{"update:activeName":function(e){t.$set(t.tab,"active",e)}}},[t.activeTab.includes("filter")?i("bk-tabpanel",{attrs:{name:"filter",title:t.$t("HostResourcePool['筛选']")}},[i("keep-alive",["filter"===t.tab.active?i("the-filter",{ref:"theFilter",attrs:{"filter-config-key":t.filterConfigKey},on:{"on-refresh":t.handleRefresh}},[t._t("business",null,{slot:"business"}),t._v(" "),t._t("scope",null,{slot:"scope"})],2):t._e()],1)],1):t._e(),t._v(" "),t.activeTab.includes("collection")?i("bk-tabpanel",{attrs:{name:"collection",title:t.$t("Hosts['收藏']")}},["collection"===t.tab.active?i("the-collection"):t._e()],1):t._e(),t._v(" "),t.activeTab.includes("history")?i("bk-tabpanel",{attrs:{name:"history",title:t.$t("Hosts['历史']")}},["history"===t.tab.active?i("the-history"):t._e()],1):t._e(),t._v(" "),i("the-setting",{attrs:{slot:"setting","active-setting":t.activeSetting,"filter-config-key":t.filterConfigKey},on:{"on-reset":t.handleReset},slot:"setting"})],1)],1)])},staticRenderFns:[]};var F=i("VU/8")(A,O,!1,function(t){i("XIby"),i("COcO")},"data-v-bd62d7ce",null).exports,E=i("BZR1");e.a={components:{cmdbHostsFilter:F,cmdbColumnsConfig:E.a},data:function(){return{properties:{biz:[],host:[],set:[],module:[]},propertyGroups:[],table:{checked:[],header:[],list:[],allList:[],pagination:{current:1,size:10,count:0},defaultSort:"bk_host_id",sort:"bk_host_id",exportUrl:window.Site.url+"hosts/export"},filter:{params:null,paramsResolver:null},slider:{show:!1,title:""},tab:{active:"attribute",attribute:{type:"details",inst:{details:{},edit:{}}}},columnsConfig:{show:!1,selected:[]}}},computed:h()({},Object(b.c)(["supplierAccount"]),Object(b.c)("userCustom",["usercustom"]),{customColumns:function(){return this.usercustom[this.table.columnsConfigKey]||[]},clipboardList:function(){return this.table.header.filter(function(t){return"checkbox"!==t.type})}}),methods:h()({},Object(b.b)("objectModelProperty",["batchSearchObjectAttribute"]),Object(b.b)("objectModelFieldGroup",["searchGroup"]),Object(b.b)("hostUpdate",["updateHost"]),{getProperties:function(){var t=this;return this.batchSearchObjectAttribute({params:{bk_obj_id:{$in:d()(this.properties)},bk_supplier_account:this.supplierAccount},config:{requestId:"hostsAttribute",fromCache:!0}}).then(function(e){return d()(t.properties).forEach(function(i){t.properties[i]=e[i]}),e})},getHostPropertyGroups:function(){var t=this;return this.searchGroup({objId:"host",config:{fromCache:!0,requestId:"hostAttributeGroup"}}).then(function(e){return t.propertyGroups=e,e})},setAllHostList:function(t){var e=this;if(this.table.allList.length!==this.table.pagination.count){var i=[];t.forEach(function(t){e.table.allList.some(function(e){return e.host.bk_host_id===t.host.bk_host_id})||i.push(t)}),this.table.allList=[].concat(u()(this.table.allList),i)}},getHostCellText:function(t,e){var i=t.objId,o=t.id,s=this.$tools.getProperty(this.properties[i],o),n=this.$tools.flatternHostItem(s,e);return this.$tools.getHostCellText(n,i,o)},handlePageChange:function(t){this.table.pagination.current=t,this.getHostList()},handleSizeChange:function(t){this.table.pagination.size=t,this.handlePageChange(1)},handleSortChange:function(t){this.table.sort=t,this.handlePageChange(1)},handleCopy:function(t){var e=this,i=this.table.allList.filter(function(t){return e.table.checked.includes(t.host.bk_host_id)}),o=[];this.$tools.clone(i).forEach(function(i){var s=e.getHostCellText(t,i);"--"!==s&&o.push(s)}),o.length?this.$copyText(o.join("\n")).then(function(){e.$success(e.$t('Common["复制成功"]'))},function(){e.$error(e.$t('Common["复制失败"]'))}):this.$info(this.$t('Common["该字段无可复制的值"]'))},handleRefresh:function(t){this.filter.params=t,this.filter.paramsResolver?this.filter.paramsResolver():this.getHostList()},handleCheckAll:function(t){var e=this;return l()(r.a.mark(function i(){var o,s;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(o=void 0,"current"!==t){i.next=5;break}o=e.table.list,i.next=9;break;case 5:return i.next=7,e.getAllHostList();case 7:s=i.sent,o=s.info;case 9:e.table.checked=o.map(function(t){return t.host.bk_host_id});case 10:case"end":return i.stop()}},i,e)}))()},handleRowClick:function(t){var e=t.host;this.slider.show=!0,this.slider.title=this.$t("Common['编辑']")+" "+e.bk_host_innerip,this.tab.attribute.inst.details=e,this.tab.attribute.type="details"},handleSave:function(t,e,i,o){this.batchUpdate(h()({},e,{bk_host_id:i.bk_host_id.toString()}))},batchUpdate:function(t){var e=this;this.updateHost(t).then(function(){e.$success(e.$t("Common['保存成功']")),e.getHostList(),e.slider.show=!1})},handleCancel:function(){this.tab.attribute.type="details"},handleEdit:function(t){var e=this;return l()(r.a.mark(function i(){var o,s;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.$http.cache.get("hostSearch");case 2:o=i.sent,s=o.info.find(function(e){return e.host.bk_host_id===t.bk_host_id}),e.tab.attribute.inst.edit=s.host,e.tab.attribute.type="update";case 6:case"end":return i.stop()}},i,e)}))()},handleMultipleEdit:function(){this.tab.attribute.type="multiple",this.slider.title=this.$t("HostResourcePool['主机属性']"),this.slider.show=!0},handleMultipleSave:function(t){this.batchUpdate(h()({},t,{bk_host_id:this.table.checked.join(",")}))},handleMultipleCancel:function(){this.slider.show=!1},handleApplyColumnsConfig:function(t){this.$store.dispatch("userCustom/saveUsercustom",s()({},this.table.columnsConfigKey,t.map(function(t){return t.bk_property_id}))),this.columnsConfig.show=!1},handleResetColumnsConfig:function(){this.$store.dispatch("userCustom/saveUsercustom",s()({},this.table.columnsConfigKey,[])),this.columnsConfig.show=!1}})}},"1hcu":function(t,e){},"302L":function(t,e){},"4WTo":function(t,e,i){var o=i("NWt+");t.exports=function(t,e){var i=[];return o(t,!1,i.push,i,e),i}},"7Doy":function(t,e,i){var o=i("EqjI"),s=i("7UMu"),n=i("dSzd")("species");t.exports=function(t){var e;return s(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!s(e.prototype)||(e=void 0),o(e)&&null===(e=e[n])&&(e=void 0)),void 0===e?Array:e}},"9Bbf":function(t,e,i){"use strict";var o=i("kM2E");t.exports=function(t){o(o.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},"9C8M":function(t,e,i){"use strict";var o=i("evD5").f,s=i("Yobk"),n=i("xH/j"),r=i("+ZMJ"),a=i("2KxR"),l=i("NWt+"),c=i("vIB/"),u=i("EGZi"),p=i("bRrM"),d=i("+E39"),f=i("06OY").fastKey,h=i("LIJb"),b=d?"_s":"size",_=function(t,e){var i,o=f(e);if("F"!==o)return t._i[o];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,c){var u=t(function(t,o){a(t,u,e,"_i"),t._t=e,t._i=s(null),t._f=void 0,t._l=void 0,t[b]=0,void 0!=o&&l(o,i,t[c],t)});return n(u.prototype,{clear:function(){for(var t=h(this,e),i=t._i,o=t._f;o;o=o.n)o.r=!0,o.p&&(o.p=o.p.n=void 0),delete i[o.i];t._f=t._l=void 0,t[b]=0},delete:function(t){var i=h(this,e),o=_(i,t);if(o){var s=o.n,n=o.p;delete i._i[o.i],o.r=!0,n&&(n.n=s),s&&(s.p=n),i._f==o&&(i._f=s),i._l==o&&(i._l=n),i[b]--}return!!o},forEach:function(t){h(this,e);for(var i,o=r(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(o(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!_(h(this,e),t)}}),d&&o(u.prototype,"size",{get:function(){return h(this,e)[b]}}),u},def:function(t,e,i){var o,s,n=_(t,e);return n?n.v=i:(t._l=n={i:s=f(e,!0),k:e,v:i,p:o=t._l,n:void 0,r:!1},t._f||(t._f=n),o&&(o.n=n),t[b]++,"F"!==s&&(t._i[s]=n)),t},getEntry:_,setStrong:function(t,e,i){c(t,e,function(t,i){this._t=h(t,e),this._k=i,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?u(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,u(1))},i?"entries":"values",!i,!0),p(e)}}},ALrJ:function(t,e,i){var o=i("+ZMJ"),s=i("MU5D"),n=i("sB3e"),r=i("QRG4"),a=i("oeOm");t.exports=function(t,e){var i=1==t,l=2==t,c=3==t,u=4==t,p=6==t,d=5==t||p,f=e||a;return function(e,a,h){for(var b,_,m=n(e),v=s(m),k=o(a,h,3),y=r(v.length),g=0,C=i?f(e,y):l?f(e,0):void 0;y>g;g++)if((d||g in v)&&(_=k(b=v[g],g,m),t))if(i)C[g]=_;else if(_)switch(t){case 3:return!0;case 5:return b;case 6:return g;case 2:C.push(b)}else if(u)return!1;return p?-1:c||u?u:C}}},BDhv:function(t,e,i){var o=i("kM2E");o(o.P+o.R,"Set",{toJSON:i("m9gC")("Set")})},COcO:function(t,e){},HpRW:function(t,e,i){"use strict";var o=i("kM2E"),s=i("lOnJ"),n=i("+ZMJ"),r=i("NWt+");t.exports=function(t){o(o.S,t,{from:function(t){var e,i,o,a,l=arguments[1];return s(this),(e=void 0!==l)&&s(l),void 0==t?new this:(i=[],e?(o=0,a=n(l,arguments[2],2),r(t,!1,function(t){i.push(a(t,o++))})):r(t,!1,i.push,i),new this(i))}})}},LIJb:function(t,e,i){var o=i("EqjI");t.exports=function(t,e){if(!o(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},Ogvo:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Xxa5"),s=i.n(o),n=i("//Fk"),r=i.n(n),a=i("exGp"),l=i.n(a),c=i("Dd8w"),u=i.n(c),p=i("NYxO"),d=i("0fZ5"),f=i("k43u"),h={mixins:[d.a],components:{cmdbAuditHistory:f.a},data:function(){return{table:{columnsConfigKey:"resource_table_columns"},filter:{filterConfigKey:"resource_filter_fields",business:-1,assigned:!1},assignBusiness:""}},computed:u()({},Object(p.c)("objectBiz",["business"])),watch:{"filter.business":function(t){this.businessResolver?this.businessResolver():this.getHostList()},customColumns:function(){this.setTableHeader()}},created:function(){var t=this;return l()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getParams();case 3:return e.next=5,r.a.all([t.getProperties(),t.getHostPropertyGroups()]);case 5:return e.next=7,t.setTableHeader();case 7:t.getHostList(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,t,[[0,10]])}))()},methods:u()({},Object(p.b)("hostSearch",["searchHost"]),Object(p.b)("hostDelete",["deleteHost"]),Object(p.b)("hostRelation",["transferResourcehostToIdlemodule"]),{getParams:function(){var t=this;return new r.a(function(e,i){t.filter.paramsResolver=function(){t.filter.paramsResolver=null,e()}})},setTableHeader:function(){var t=this;return new r.a(function(e,i){e(t.$tools.getHeaderProperties(t.properties.host,t.customColumns))}).then(function(e){t.table.header=[{id:"bk_host_id",type:"checkbox",objId:"host",width:50}].concat(e.map(function(t){return{id:t.bk_property_id,name:t.bk_property_name,objId:t.bk_obj_id}})),t.columnsConfig.selected=e.map(function(t){return t.bk_property_id})})},getHostList:function(){var t=this;this.searchHost({params:u()({},this.getScopedParams(),{bk_biz_id:this.filter.business,page:{start:(this.table.pagination.current-1)*this.table.pagination.size,limit:this.table.pagination.size,sort:this.table.sort}}),config:{requestId:"hostSearch"}}).then(function(e){return t.table.pagination.count=e.count,t.table.list=e.info,t.setAllHostList(e.info),e}).catch(function(e){t.table.checked=[],t.table.list=[],t.table.pagination.count=0})},getAllHostList:function(){var t=this;return this.searchHost({params:u()({},this.getScopedParams(),{bk_biz_id:this.filter.business,page:{}}),config:{requestId:"hostSearchAll"}}).then(function(e){return t.table.allList=e.info,e})},getScopedParams:function(){var t=this.$tools.clone(this.filter.params);this.filter.assigned||t.condition.find(function(t){return"biz"===t.bk_obj_id}).condition.push({field:"default",operator:"$eq",value:1});return t},routeToHistory:function(){this.$router.push("/history/host?relative=/resource")},handleAssignHosts:function(t,e){var i=this;t&&(this.hasSelectAssignedHost()?(this.$error(this.$t('Hosts["请勿选择已分配主机"]')),this.assignBusiness=""):this.$bkInfo({title:this.$t("HostResourcePool['请确认是否转移']"),content:this.getConfirmContent(e),confirmFn:function(){i.assignHosts(e)},cancelFn:function(){i.assignBusiness=""}}))},hasSelectAssignedHost:function(){var t=this;return this.table.allList.filter(function(e){return t.table.checked.includes(e.host.bk_host_id)}).some(function(t){return t.biz.some(function(t){return 1!==t.default})})},assignHosts:function(t){var e=this;this.transferResourcehostToIdlemodule({params:{bk_biz_id:t.bk_biz_id,bk_host_id:this.table.checked}}).then(function(){e.$success(e.$t("HostResourcePool['分配成功']")),e.table.checked=[],e.assignBusiness="",e.handlePageChange(1)})},getConfirmContent:function(t){var e=this.$createElement;return"en"===this.$i18n.locale?e("p",[e("span","Selected "),e("span",{style:{color:"#3c96ff"}},this.table.checked.length),e("span"," Hosts Transfer to Idle machine under "),e("span",{style:{color:"#3c96ff"}},t.bk_biz_name)]):e("p",[e("span","选中的 "),e("span",{style:{color:"#3c96ff"}},this.table.checked.length),e("span"," 个主机转移到 "),e("span",{style:{color:"#3c96ff"}},t.bk_biz_name),e("span"," 下的空闲机模块")])},handleMultipleDelete:function(){var t=this;this.$bkInfo({title:this.$t("HostResourcePool['确定删除选中的主机']")+"？",confirmFn:function(){t.deleteHost({params:{data:{bk_host_id:t.table.checked.join(","),bk_supplier_account:t.supplierAccount}}}).then(function(){t.$bkInfo({statusOpts:{title:t.$t("HostResourcePool['成功删除选中的主机']"),subtitle:!1},type:"success"}),t.table.checked=[],t.handlePageChange(1)})}})}})},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"resource-layout clearfix"},[i("cmdb-hosts-filter",{staticClass:"resource-filter fr",attrs:{"active-tab":["filter"],"active-setting":["reset","filter-config"],"filter-config-key":t.filter.filterConfigKey},on:{"on-refresh":t.handleRefresh}},[i("div",{staticClass:"filter-group",attrs:{slot:"scope"},slot:"scope"},[i("label",{staticClass:"filter-label"},[t._v(t._s(t.$t("Hosts['搜索范围']")))]),t._v(" "),i("cmdb-form-bool",{staticClass:"filter-field",attrs:{disabled:!0,checked:!0}},[i("span",{staticClass:"filter-field-label"},[t._v(t._s(t.$t("Hosts['未分配主机']")))])]),t._v(" "),i("cmdb-form-bool",{staticClass:"filter-field",model:{value:t.filter.assigned,callback:function(e){t.$set(t.filter,"assigned",e)},expression:"filter.assigned"}},[i("span",{staticClass:"filter-field-label"},[t._v(t._s(t.$t("Hosts['已分配主机']")))])])],1)]),t._v(" "),i("div",{staticClass:"resource-main"},[i("div",{staticClass:"resource-options clearfix"},[i("cmdb-selector",{staticClass:"options-business-selector",attrs:{placeholder:t.$t("HostResourcePool['分配到业务空闲机池']"),disabled:!t.table.checked.length,list:t.business,"auto-select":!1,"setting-key":"bk_biz_id","display-key":"bk_biz_name"},on:{"on-selected":t.handleAssignHosts},model:{value:t.assignBusiness,callback:function(e){t.assignBusiness=e},expression:"assignBusiness"}}),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("BusinessTopology['修改']"),expression:"$t('BusinessTopology[\\'修改\\']')"}],staticClass:"options-button",attrs:{type:"default",disabled:!t.table.checked.length},on:{click:t.handleMultipleEdit}},[i("i",{staticClass:"icon-cc-edit"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Common['删除']"),expression:"$t('Common[\\'删除\\']')"}],staticClass:"options-button options-button-delete",attrs:{type:"default",disabled:!t.table.checked.length},on:{click:t.handleMultipleDelete}},[i("i",{staticClass:"icon-cc-del"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("HostResourcePool['导出选中']"),expression:"$t('HostResourcePool[\\'导出选中\\']')"}],staticClass:"options-button",attrs:{type:"submit default",form:"exportForm",disabled:!t.table.checked.length}},[i("i",{staticClass:"icon-cc-derivation"})]),t._v(" "),i("form",{attrs:{id:"exportForm",action:t.table.exportUrl,method:"POST",hidden:""}},[i("input",{attrs:{type:"hidden",name:"bk_host_id"},domProps:{value:t.table.checked}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"bk_biz_id",value:"-1"}})]),t._v(" "),i("cmdb-clipboard-selector",{staticClass:"options-button",attrs:{list:t.clipboardList,disabled:!t.table.checked.length},on:{"on-copy":t.handleCopy}}),t._v(" "),i("div",{staticClass:"fr"},[i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("BusinessTopology['列表显示属性配置']"),expression:"$t('BusinessTopology[\\'列表显示属性配置\\']')"}],staticClass:"options-button",attrs:{type:"default"},on:{click:function(e){t.columnsConfig.show=!0}}},[i("i",{staticClass:"icon-cc-setting"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("Common['查看删除历史']"),expression:"$t('Common[\\'查看删除历史\\']')"}],staticClass:"options-button",attrs:{type:"default"},on:{click:t.routeToHistory}},[i("i",{staticClass:"icon-cc-history"})]),t._v(" "),i("bk-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.$t("HostResourcePool['导入主机']"),expression:"$t('HostResourcePool[\\'导入主机\\']')"}],staticClass:"options-button",attrs:{type:"primary"}},[i("i",{staticClass:"icon-cc-import"})])],1)],1),t._v(" "),i("cmdb-table",{staticClass:"resource-table",attrs:{loading:t.$loading(),checked:t.table.checked,header:t.table.header,list:t.table.list,pagination:t.table.pagination,defaultSort:t.table.defaultSort,wrapperMinusHeight:157},on:{"update:checked":function(e){t.$set(t.table,"checked",e)},"update:pagination":function(e){t.$set(t.table,"pagination",e)},handleRowClick:t.handleRowClick,handleSortChange:t.handleSortChange,handlePageChange:t.handlePageChange,handleSizeChange:t.handleSizeChange,handleCheckAll:t.handleCheckAll},scopedSlots:t._u([t._l(t.table.header,function(e,o){return{key:e.id,fn:function(o){var s=o.item;return["bk_host_id"===e.id?i("label",{staticClass:"bk-form-checkbox bk-checkbox-small",staticStyle:{width:"100%","text-align":"center"},on:{click:function(t){t.stopPropagation()}}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.table.checked,expression:"table.checked"}],attrs:{type:"checkbox"},domProps:{value:s.host.bk_host_id,checked:Array.isArray(t.table.checked)?t._i(t.table.checked,s.host.bk_host_id)>-1:t.table.checked},on:{change:function(e){var i=t.table.checked,o=e.target,n=!!o.checked;if(Array.isArray(i)){var r=s.host.bk_host_id,a=t._i(i,r);o.checked?a<0&&t.$set(t.table,"checked",i.concat([r])):a>-1&&t.$set(t.table,"checked",i.slice(0,a).concat(i.slice(a+1)))}else t.$set(t.table,"checked",n)}}})]):i("span",[t._v("\n                    "+t._s(t.getHostCellText(e,s))+"\n                ")])]}}})])})],1),t._v(" "),i("cmdb-slider",{attrs:{isShow:t.slider.show,title:t.slider.title},on:{"update:isShow":function(e){t.$set(t.slider,"show",e)}}},[i("bk-tab",{attrs:{slot:"content","active-name":t.tab.active},on:{"update:activeName":function(e){t.$set(t.tab,"active",e)}},slot:"content"},[i("bk-tabpanel",{attrs:{name:"attribute",title:t.$t("Common['属性']")}},["details"===t.tab.attribute.type?i("cmdb-details",{attrs:{properties:t.properties.host,propertyGroups:t.propertyGroups,inst:t.tab.attribute.inst.details,"show-delete":!1},on:{"on-edit":t.handleEdit}}):"update"===t.tab.attribute.type?i("cmdb-form",{attrs:{properties:t.properties.host,propertyGroups:t.propertyGroups,inst:t.tab.attribute.inst.edit,type:t.tab.attribute.type},on:{"on-submit":t.handleSave,"on-cancel":t.handleCancel}}):"multiple"===t.tab.attribute.type?i("cmdb-form-multiple",{attrs:{properties:t.properties.host,propertyGroups:t.propertyGroups},on:{"on-submit":t.handleMultipleSave,"on-cancel":t.handleMultipleCancel}}):t._e()],1),t._v(" "),i("bk-tabpanel",{attrs:{name:"relevance",title:t.$t("HostResourcePool['关联']")}}),t._v(" "),i("bk-tabpanel",{attrs:{name:"history",title:t.$t("HostResourcePool['变更记录']")}},["history"===t.tab.active?i("cmdb-audit-history",{attrs:{target:"host","ext-key":{$in:[t.tab.attribute.inst.details.bk_host_innerip]}}}):t._e()],1)],1)],1),t._v(" "),i("cmdb-slider",{attrs:{"is-show":t.columnsConfig.show,width:600,title:t.$t("BusinessTopology['列表显示属性配置']")},on:{"update:isShow":function(e){t.$set(t.columnsConfig,"show",e)}}},[i("cmdb-columns-config",{attrs:{slot:"content",properties:t.properties.host,selected:t.columnsConfig.selected},on:{"on-apply":t.handleApplyColumnsConfig,"on-cancel":function(e){t.columnsConfig.show=!1},"on-reset":t.handleResetColumnsConfig},slot:"content"})],1)],1)},staticRenderFns:[]};var _=i("VU/8")(h,b,!1,function(t){i("rV7i")},"data-v-8b82f176",null);e.default=_.exports},VB70:function(t,e){},XIby:function(t,e){},ioQ5:function(t,e,i){i("HpRW")("Set")},lHA8:function(t,e,i){t.exports={default:i("pPW7"),__esModule:!0}},m9gC:function(t,e,i){var o=i("RY/4"),s=i("4WTo");t.exports=function(t){return function(){if(o(this)!=t)throw TypeError(t+"#toJSON isn't generic");return s(this)}}},oNmr:function(t,e,i){i("9Bbf")("Set")},oeOm:function(t,e,i){var o=i("7Doy");t.exports=function(t,e){return new(o(t))(e)}},pJGF:function(t,e){},pPW7:function(t,e,i){i("M6a0"),i("zQR9"),i("+tPU"),i("ttyz"),i("BDhv"),i("oNmr"),i("ioQ5"),t.exports=i("FeBl").Set},qo66:function(t,e,i){"use strict";var o=i("7KvD"),s=i("kM2E"),n=i("06OY"),r=i("S82l"),a=i("hJx8"),l=i("xH/j"),c=i("NWt+"),u=i("2KxR"),p=i("EqjI"),d=i("e6n0"),f=i("evD5").f,h=i("ALrJ")(0),b=i("+E39");t.exports=function(t,e,i,_,m,v){var k=o[t],y=k,g=m?"set":"add",C=y&&y.prototype,$={};return b&&"function"==typeof y&&(v||C.forEach&&!r(function(){(new y).entries().next()}))?(y=e(function(e,i){u(e,y,t,"_c"),e._c=new k,void 0!=i&&c(i,m,e[g],e)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in C&&(!v||"clear"!=t)&&a(y.prototype,t,function(i,o){if(u(this,y,t),!e&&v&&!p(i))return"get"==t&&void 0;var s=this._c[t](0===i?0:i,o);return e?this:s})}),v||f(y.prototype,"size",{get:function(){return this._c.size}})):(y=_.getConstructor(e,t,m,g),l(y.prototype,i),n.NEED=!0),d(y,t),$[t]=y,s(s.G+s.W+s.F,$),v||_.setStrong(y,t,m),y}},rV7i:function(t,e){},ttyz:function(t,e,i){"use strict";var o=i("9C8M"),s=i("LIJb");t.exports=i("qo66")("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return o.def(s(this,"Set"),t=0===t?0:t,t)}},o)},uioc:function(t,e){}});
//# sourceMappingURL=2.63a546229ed2f8bf8430.js.map